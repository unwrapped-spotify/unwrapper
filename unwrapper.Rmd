---
title: "Example page"
output: html_document
---

```{r setup, echo = FALSE, include = FALSE}
# Load libraries
library(dplyr)            # Data frame operations
library(jsonlite)         # JSON operations
library(janitor)          # Cleaning operations
library(lubridate)        # Date/time operations
library(ggplot2)          # Plotting operations
```

```{r load-data, echo = FALSE, include = FALSE}
# Load streaming data

streaming_data <- fromJSON(txt = "data.json") %>% as_tibble

#streaming_data <- list.files("data", full.names = TRUE) %>%
#  lapply(function(filename) {fromJSON(txt = filename) %>% as_tibble}) %>%
#  bind_rows %>%
#  clean_names
```

```{r heatmap-plot, echo = FALSE}

streaming_data %>%
  mutate(
    datetime = as.POSIXct(end_time),
    date = as.Date(datetime),
    week = week(datetime),
    hour = hour(datetime),
  ) %>%
  group_by(week) %>%
  summarise(minutes_played = sum(ms_played) / 1000 / 60, date = min(date)) %>%
  ggplot() +
  geom_line(mapping = aes(x = date, y = minutes_played))


```